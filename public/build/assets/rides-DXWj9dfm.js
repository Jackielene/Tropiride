import{r as a,j as e,H as Q,L as F,a as X}from"./app-D2KhOlPS.js";import{A as Z}from"./app-layout-BuZHd0iL.js";import{C as P,b as A,c as T,d as D,a as E}from"./card-CTMh3Ccf.js";import{A as ee,a as te,b as se}from"./ErrorBoundary-DhJ2_a8D.js";import{B as w}from"./badge-C9baLLyP.js";import{B as x}from"./button-DRgzOgcv.js";import{D as ae,a as re,b as le,c as ce,d as ne,e as ie}from"./dialog-ChcKln-Q.js";import{a as H}from"./axios-BqQSuAxk.js";import{N as W}from"./navigation-C8gpJZYl.js";import{C as R}from"./circle-alert-5v61Kg-F.js";import{c as g}from"./createLucideIcon-EMwdt5a8.js";import{M as L}from"./map-pin-BuTsegXW.js";import{C as de}from"./circle-check-big-CGACond5.js";import{C as z}from"./car-D1S1GftI.js";import{P as oe}from"./phone-DNgV663h.js";/* empty css            */import"./index-C3HMWAIV.js";import"./index-C-hE0QHb.js";import"./index-6XFs-mRv.js";import"./index-D5JU00dO.js";import"./index-BHDVE5T7.js";import"./floating-ui.react-dom-BzSDvg-6.js";import"./index-1ri6WIs6.js";import"./index-D329iiHL.js";import"./index-CMWG4mbA.js";import"./index-tyedukNl.js";import"./message-square-B3ZYgRdM.js";import"./app-logo-icon-B_p9kvRG.js";import"./shield-check-Buig286y.js";import"./clsx-B-dksMZM.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],ue=g("ArrowLeft",me);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=[["path",{d:"m16.24 7.76-1.804 5.411a2 2 0 0 1-1.265 1.265L7.76 16.24l1.804-5.411a2 2 0 0 1 1.265-1.265z",key:"9ktpf1"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],pe=g("Compass",xe);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"m12 14 4-4",key:"9kzdfg"}],["path",{d:"M3.34 19a10 10 0 1 1 17.32 0",key:"19p75a"}]],fe=g("Gauge",he);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],je=g("PowerOff",ge);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]],ve=g("Power",Ne);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["path",{d:"M2 20h.01",key:"4haj6o"}],["path",{d:"M7 20v-4",key:"j294jx"}],["path",{d:"M12 20v-8",key:"i3yub9"}],["path",{d:"M17 20V8",key:"1tkaf5"}],["path",{d:"M22 4v16",key:"sih9yq"}]],be=g("Signal",ye),M="tropiride_gps_tracking",v="tropiride_tracking_booking_id";function ke({bookingId:i,isActiveRide:p,onTrackingChange:o}){const[l,d]=a.useState(!1),[c,j]=a.useState(null),[h,n]=a.useState(null),[y,S]=a.useState(null),[m,b]=a.useState(null),[u,t]=a.useState(null),[f,K]=a.useState(!1),U=a.useRef(!1),k=a.useCallback((s,r)=>{s&&r?(localStorage.setItem(M,"true"),localStorage.setItem(v,String(r))):(localStorage.removeItem(M),localStorage.removeItem(v))},[]),$=a.useCallback(()=>{const s=localStorage.getItem(M),r=localStorage.getItem(v);return s==="true"&&r!==null},[]),G=a.useCallback(async s=>{const r=i||Number(localStorage.getItem(v));if(!r){console.warn("No booking ID for GPS update");return}try{await H.post("/gps/update",{latitude:s.latitude,longitude:s.longitude,heading:s.heading,speed:s.speed,accuracy:s.accuracy,booking_id:r}),S(new Date),n(null)}catch(N){console.error("Failed to send GPS update:",N)}},[i]),O=a.useCallback(s=>{const r={latitude:s.coords.latitude,longitude:s.coords.longitude,heading:s.coords.heading,speed:s.coords.speed?s.coords.speed*3.6:null,accuracy:s.coords.accuracy};j(r),n(null)},[]),B=a.useCallback(s=>{let r="Unable to get location";switch(s.code){case s.PERMISSION_DENIED:r="Location permission denied. Please enable GPS.";break;case s.POSITION_UNAVAILABLE:r="Location unavailable. Check your GPS.";break;case s.TIMEOUT:r="Location request timed out.";break}n(r)},[]),C=a.useCallback((s=!1)=>{if(!navigator.geolocation){n("Geolocation is not supported");return}const r=i||Number(localStorage.getItem(v));if(!r&&!s){n("No booking selected for tracking");return}d(!0),n(null),o?.(!0),r&&k(!0,r);const N=navigator.geolocation.watchPosition(O,B,{enableHighAccuracy:!0,timeout:1e4,maximumAge:0});b(N);const J=setInterval(()=>{j(I=>(I&&G(I),I))},2e3);t(J)},[O,B,G,o,i,k]),_=a.useCallback(async()=>{d(!1),o?.(!1),k(!1,null),m!==null&&(navigator.geolocation.clearWatch(m),b(null)),u&&(clearInterval(u),t(null));try{await H.post("/gps/stop")}catch(s){console.error("Failed to notify server:",s)}},[m,u,o,k]);a.useEffect(()=>{!f&&!U.current&&(K(!0),$()&&p&&(console.log("Auto-starting GPS tracking (was previously enabled)"),U.current=!0,setTimeout(()=>{C(!0)},500)))},[f,$,p,C]),a.useEffect(()=>()=>{m!==null&&navigator.geolocation.clearWatch(m),u&&clearInterval(u)},[m,u]),a.useEffect(()=>{!p&&l&&_()},[p,l,_]);const V=s=>s===null?"N/A":`${Math.round(s)} km/h`,Y=s=>{if(s===null)return"N/A";const r=["N","NE","E","SE","S","SW","W","NW"],N=Math.round(s/45)%8;return`${Math.round(s)}Â° ${r[N]}`},q=()=>{if(!y)return"Never";const s=Math.floor((new Date().getTime()-y.getTime())/1e3);return s<5?"Just now":s<60?`${s}s ago`:`${Math.floor(s/60)}m ago`};return e.jsxs(P,{className:`transition-all ${l?"border-green-300 bg-green-50/50 dark:border-green-800 dark:bg-green-950/30":""}`,children:[e.jsxs(A,{className:"pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(T,{className:"flex items-center gap-2 text-base",children:[e.jsx(W,{className:`h-5 w-5 ${l?"text-green-600 animate-pulse":"text-muted-foreground"}`}),"GPS Tracking"]}),e.jsx(w,{variant:l?"default":"secondary",children:l?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse mr-1.5"}),"Live"]}):"Off"})]}),e.jsx(D,{children:l?"Your location is being shared with the customer":"Start tracking to share your location with the customer"})]}),e.jsxs(E,{className:"space-y-4",children:[h&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-red-50 dark:bg-red-950 text-red-700 dark:text-red-300 rounded-lg text-sm",children:[e.jsx(R,{className:"h-4 w-4 flex-shrink-0"}),h]}),l&&c&&e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-background rounded-lg border",children:[e.jsx(fe,{className:"h-4 w-4 text-blue-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Speed"}),e.jsx("p",{className:"text-sm font-semibold",children:V(c.speed)})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-background rounded-lg border",children:[e.jsx(pe,{className:"h-4 w-4 text-orange-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Heading"}),e.jsx("p",{className:"text-sm font-semibold",children:Y(c.heading)})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-background rounded-lg border",children:[e.jsx(be,{className:"h-4 w-4 text-green-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Accuracy"}),e.jsx("p",{className:"text-sm font-semibold",children:c.accuracy?`Â±${Math.round(c.accuracy)}m`:"N/A"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-background rounded-lg border",children:[e.jsx(L,{className:"h-4 w-4 text-purple-600"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Last Sent"}),e.jsx("p",{className:"text-sm font-semibold",children:q()})]})]})]}),l&&c&&e.jsxs("div",{className:"p-2 bg-muted rounded-lg text-xs text-muted-foreground text-center",children:["ðŸ“ ",c.latitude.toFixed(6),", ",c.longitude.toFixed(6)]}),!p&&!l&&e.jsxs("div",{className:"p-3 bg-amber-50 dark:bg-amber-950 text-amber-700 dark:text-amber-300 rounded-lg text-sm flex items-center gap-2",children:[e.jsx(R,{className:"h-4 w-4"}),"GPS tracking is available for accepted rides"]}),e.jsx("div",{className:"flex gap-2",children:l?e.jsxs(x,{onClick:_,variant:"destructive",className:"flex-1 gap-2",children:[e.jsx(je,{className:"h-4 w-4"}),"Stop Tracking"]}):e.jsxs(x,{onClick:C,disabled:!p,className:"flex-1 gap-2",children:[e.jsx(ve,{className:"h-4 w-4"}),"Start Tracking"]})}),l&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600 dark:text-green-400",children:[e.jsx(de,{className:"h-4 w-4"}),"Customer can see your live location"]})]})]})}function et({assignedBookings:i=[],driver:p}){const[o,l]=a.useState(null),[d,c]=a.useState(null),[j,h]=a.useState(null),n=i.filter(t=>t.status==="accepted"||t.status==="in_progress"),y=t=>t.split(" ").map(f=>f[0]).join("").toUpperCase().slice(0,2),S=t=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP"}).format(t),m=t=>{switch(t){case"completed":return"default";case"pending":return"secondary";case"in_progress":return"outline";case"cancelled":return"destructive";default:return"outline"}},b=(t,f)=>{l(t),X.patch(`/driver/bookings/${t}/status`,{status:f},{preserveScroll:!0,onFinish:()=>{l(null)}})},u=()=>{d&&(b(d.bookingId,d.status),c(null))};return e.jsxs(Z,{children:[e.jsx(Q,{title:"My Rides - Driver"}),e.jsxs("div",{className:"flex h-full flex-1 flex-col gap-6 overflow-x-hidden p-4 md:p-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-primary uppercase tracking-wide",children:"My Rides"}),e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Assigned Bookings"}),e.jsx("p",{className:"text-muted-foreground mt-1",children:"Manage every ride youâ€™ve accepted and keep an eye on their status."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(x,{variant:"outline",asChild:!0,children:e.jsxs(F,{href:"/driver/dashboard",children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Back to Dashboard"]})}),e.jsx(x,{asChild:!0,children:e.jsx(F,{href:"/driver/messages",children:"Go to Messages"})})]})]}),n.length>0&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:[e.jsx("div",{className:"md:col-span-1",children:e.jsx(ke,{bookingId:j||n[0]?.id||null,isActiveRide:n.length>0,onTrackingChange:t=>{t&&n.length>0?h(n[0].id):h(null)}})}),e.jsx("div",{className:"md:col-span-1 lg:col-span-2",children:e.jsxs(P,{className:"h-full",children:[e.jsxs(A,{className:"pb-3",children:[e.jsxs(T,{className:"flex items-center gap-2 text-base",children:[e.jsx(W,{className:"h-5 w-5 text-primary"}),"Active Rides for Tracking"]}),e.jsx(D,{children:"Select which ride to share your GPS location with"})]}),e.jsx(E,{children:e.jsx("div",{className:"space-y-2",children:n.map(t=>e.jsx("button",{onClick:()=>h(t.id),className:`w-full text-left p-3 rounded-lg border transition-all ${j===t.id?"border-primary bg-primary/5 shadow-sm":"border-muted hover:border-primary/50"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-sm",children:["#",t.id," - ",t.customer?.name||"Unknown"]}),e.jsx("p",{className:"text-xs text-muted-foreground truncate max-w-[250px]",children:t.pickup_location})]}),e.jsx(w,{variant:t.status==="in_progress"?"default":"secondary",children:t.status.replace("_"," ")})]})},t.id))})})]})})]}),e.jsxs(P,{children:[e.jsxs(A,{children:[e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-5 w-5 text-primary"}),"My Rides"]}),e.jsx(D,{children:i.length?`You currently have ${i.length} ride${i.length>1?"s":""}.`:"No rides assigned yet. Accept bookings to start driving."})]}),e.jsx(E,{className:"p-0",children:i.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted/40",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-4 font-semibold text-xs uppercase text-muted-foreground",children:"Customer"}),e.jsx("th",{className:"text-left p-4 font-semibold text-xs uppercase text-muted-foreground",children:"Route"}),e.jsx("th",{className:"text-left p-4 font-semibold text-xs uppercase text-muted-foreground",children:"Vehicle"}),e.jsx("th",{className:"text-left p-4 font-semibold text-xs uppercase text-muted-foreground",children:"Schedule"}),e.jsx("th",{className:"text-left p-4 font-semibold text-xs uppercase text-muted-foreground",children:"Fare"}),e.jsx("th",{className:"text-left p-4 font-semibold text-xs uppercase text-muted-foreground",children:"Status"}),e.jsx("th",{className:"text-left p-4 font-semibold text-xs uppercase text-muted-foreground",children:"Actions"})]})}),e.jsx("tbody",{children:i.map(t=>e.jsxs("tr",{className:"border-b hover:bg-muted/30 transition-colors",children:[e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ee,{className:"h-10 w-10 border-2",children:[e.jsx(te,{src:t.customer?.email?`https://ui-avatars.com/api/?name=${encodeURIComponent(t.customer.name)}&background=0ea5e9&color=fff`:void 0}),e.jsx(se,{children:y(t.customer?.name||"Unknown")})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:t.customer?.name||"Unknown"}),e.jsxs("p",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[e.jsx(oe,{className:"h-3 w-3"}),t.customer?.phone??"No phone"]})]})]})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-start gap-2 max-w-xs",children:[e.jsx(L,{className:"h-3 w-3 text-green-600 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm truncate",children:t.pickup_location})]}),e.jsxs("div",{className:"flex items-start gap-2 max-w-xs",children:[e.jsx(L,{className:"h-3 w-3 text-red-600 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm truncate text-muted-foreground",children:t.dropoff_location})]}),t.distance_km&&e.jsxs("p",{className:"text-xs text-muted-foreground ml-5",children:[t.distance_km," km"]})]})}),e.jsxs("td",{className:"p-4",children:[t.vehicle_type&&e.jsx(w,{variant:"outline",className:"text-xs capitalize",children:t.vehicle_type}),t.passengers&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[t.passengers," pax"]})]}),e.jsx("td",{className:"p-4",children:t.pickup_date&&e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium",children:new Date(t.pickup_date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}),t.pickup_time&&e.jsx("p",{className:"text-xs text-muted-foreground",children:t.pickup_time})]})}),e.jsx("td",{className:"p-4",children:e.jsx("span",{className:"font-semibold",children:S(t.total_amount||t.estimated_fare||0)})}),e.jsx("td",{className:"p-4",children:e.jsx(w,{variant:m(t.status),className:"text-xs capitalize",children:t.status.replace("_"," ")})}),e.jsx("td",{className:"p-4",children:e.jsxs("div",{className:"flex gap-2",children:[t.status==="pending"&&e.jsx(x,{size:"sm",variant:"outline",onClick:()=>c({bookingId:t.id,status:"in_progress"}),disabled:o===t.id,children:"Start"}),t.status==="in_progress"&&e.jsx(x,{size:"sm",onClick:()=>c({bookingId:t.id,status:"completed"}),disabled:o===t.id,children:"Complete"})]})})]},t.id))})]})}):e.jsxs("div",{className:"text-center py-16",children:[e.jsx(z,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"text-muted-foreground font-medium",children:"No assigned rides yet"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Once you accept a booking, it will appear here."})]})})]})]}),e.jsx(ae,{open:!!d,onOpenChange:t=>!t&&c(null),children:e.jsxs(re,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Update Ride Status"}),e.jsx(ne,{children:d?.status==="in_progress"?"Move this booking to In Progress? Customers will see that you have started the trip.":"Mark this booking as completed? This will finish the ride and archive it."})]}),e.jsxs(ie,{className:"gap-2 sm:gap-0",children:[e.jsx(x,{variant:"outline",onClick:()=>c(null),children:"Cancel"}),e.jsx(x,{onClick:u,disabled:o===d?.bookingId,children:o===d?.bookingId?"Updating...":"Confirm"})]})]})})]})}export{et as default};
